{"version":3,"file":"CDScene-DfqVM72m.js","sources":["../../src/vue/src/pages/Thematique/blocks/webgl/CDScene.ts"],"sourcesContent":["import { WebGLRenderParams, WebGLSceneOptions } from \"components/WebGL/gl\";\nimport { WebGLScene } from 'components/WebGL/three/glScene';\nimport { damp } from \"maath/easing\";\nimport emitter, { EVENTS } from \"plugins/store/events\";\nimport { mainWebGLRenderer } from \"plugins/webgl/three\";\nimport { calculateUnitSize, getPixelSize } from \"plugins/webgl/utils\";\nimport { AmbientLight, BackSide, Box3, BoxGeometry, CompressedTexture, DirectionalLight, DoubleSide, FrontSide, Group, LinearToneMapping, Mesh, MeshBasicMaterial, MeshStandardMaterial, NearestFilter, Object3D, PerspectiveCamera, PlaneGeometry, Raycaster, SRGBColorSpace, Texture, Vector2, Vector3 } from \"three\";\nimport { OrbitControls } from \"three/examples/jsm/controls/OrbitControls\";\n// import { RoomEnvironment } from 'three/examples/jsm/environments/RoomEnvironment.js';\nimport { store as interfaceStore } from 'store/interface';\nimport { store as loaderStore } from 'ui/Loader/store';\nimport { gsap } from \"vendors/gsap\";\n\ninterface InteractiveMeshes {\n  disc?: Mesh;\n  caseFront?: Object3D;\n  caseBack?: Object3D;\n  article?: Group;\n  click?: Mesh;\n  clickButtton?: Mesh;\n  picto?: Mesh;\n}\n\nconst DELAY_CLICK = 350;\n\nexport class CDScene extends WebGLScene {\n\n  handlers: Obj;\n  mouse: Vector2 = new Vector2();\n\n  moveArticle = false;\n\n  raycaster: Raycaster;\n\n  clickTimers = { start: 0, end: 0 };\n  isDown = false;\n\n  container: Group;\n  interactiveMesh: InteractiveMeshes = {}\n\n  lights: Obj = {};\n\n  status = {\n    toggle: false,\n    reduce: false,\n  }\n\n  orbitControls: OrbitControls;\n  orbitDefaultState: Obj = {};\n\n  // pmremGenerator : PMREMGenerator\n\n  constructor(options: WebGLSceneOptions) {\n    // new glScene(options)\n    super(options);\n\n    this.camera.position.z = 3.5;\n\n    mainWebGLRenderer!.toneMapping = LinearToneMapping;\n\n    this.handlers = {\n      clickDown: this.onClickDown.bind(this),\n      click: this.onClick.bind(this),\n      move: this.onMouseMove.bind(this),\n    }\n\n    this.container = new Group();\n    this.container.position.x = -this.container.scale.x / 2;\n    this.container.visible = false;\n    this.orbitControls = new OrbitControls(this.getActiveCamera(), mainWebGLRenderer!.domElement);\n    this.orbitControls.enableDamping = true;\n    this.orbitControls.dampingFactor = 0.1\n    this.orbitControls.enablePan = false;\n    this.orbitControls.enableZoom = false;\n\n    // this.pmremGenerator = new PMREMGenerator(mainWebGLRenderer!);\n    // this.pmremGenerator.compileEquirectangularShader();\n    // this.scene.environment = this.pmremGenerator.fromScene(new RoomEnvironment()).texture;\n    // this.scene.environmentIntensity = .25; \n\n    this.raycaster = new Raycaster();\n\n    return this;\n  }\n\n  async build() {\n    this.scene.add(this.container);\n\n    const model = loaderStore.getModel('cd').clone();\n    model.name = \"cd\"\n    model.rotation.y = -Math.PI / 2;\n    model.scale.multiplyScalar(.7);\n    this.container.add(model);\n\n    model.traverse((child) => {\n      const c = child as Mesh;\n      // this one for translating the disc\n      if (c.name === \"CD_1\") {\n        this.interactiveMesh.disc = c;\n        this.interactiveMesh.disc.position.set(0, 0, 0)\n      }\n\n      // this one for translating the front\n      if (c.name === \"Case_Front_0\") {\n        this.interactiveMesh.caseFront = c;\n        this.interactiveMesh.caseFront.rotation.y = 0;\n      }\n\n      // this one for translating the back\n      if (c.name === \"Case_Back_2\") {\n        this.interactiveMesh.caseBack = c;\n      }\n    });\n\n    //center the model\n    const box = new Box3().setFromObject(this.container);\n    const size = box.getSize(new Vector3());\n    model.position.y = -size.y / 2;\n    model.position.x = size.x / 2;\n\n    //---assign textures\n    const coverFront = await loaderStore.getLoader(\"texture\")?.loadAsync(this.settings?.folder + this.settings?.recto);\n    if (coverFront) {\n      this.prepareTexture(coverFront)\n\n      const frontMesh = this.interactiveMesh.caseFront?.getObjectByName(\"Object_11\") as Mesh;\n      const frontMaterial = frontMesh.material as MeshStandardMaterial;\n      frontMaterial.map = coverFront;\n      frontMaterial.side = BackSide;\n\n      const translucent = this.interactiveMesh.caseFront?.getObjectByName(\"Object_10\") as Mesh;\n      const translucentMaterial = translucent?.material as MeshStandardMaterial;\n\n      const newMat = new MeshStandardMaterial().copy(translucentMaterial);\n      newMat.opacity = 1;\n      newMat.side = DoubleSide;\n      newMat.color.setStyle(\"#3f3f3f\");\n      translucent.material = newMat;\n    }\n\n    const coverBack = await loaderStore.getLoader(\"texture\")?.loadAsync(this.settings?.folder + this.settings?.verso);\n    if (coverBack) {\n      this.prepareTexture(coverBack);\n\n      const neutralMat = new MeshStandardMaterial({ color: 0x3F3F3F, roughness: 0.5, metalness: 0.5 });\n      const backMaterial = new MeshStandardMaterial({ side: FrontSide, map: coverBack })\n      const backMesh = new Mesh(new BoxGeometry(1, 1, 0.015), [\n        neutralMat,\n        neutralMat,\n        neutralMat,\n        neutralMat,\n        neutralMat,\n        backMaterial\n      ]);\n\n      backMesh.rotation.y = Math.PI / 2;\n      backMesh.position.x = -0.02;\n      backMesh.position.z = -0.1;\n      backMesh.scale.multiplyScalar(1.97);\n      this.interactiveMesh.caseBack?.add(backMesh);\n\n      const translucent = this.interactiveMesh.caseBack?.getObjectByName(\"Object_5\") as Mesh;\n      if (translucent) {\n        (translucent.material as MeshStandardMaterial).opacity = .05;\n      }\n    }\n\n    //--- Add Article\n    if (this.settings?.article) {\n      const articleGroup = new Group();\n      this.container.add(articleGroup);\n      this.interactiveMesh.article = articleGroup;\n\n      const isArray = !(typeof this.settings?.article === 'string');\n      const articleUrl = this.settings?.folder + (isArray ? this.settings?.article[0] : this.settings?.article);\n      const articleTexture = await loaderStore.getLoader(\"texture\")?.loadAsync(articleUrl);\n      if (articleTexture) {\n        this.prepareTexture(articleTexture, false);\n\n        const whiteMat = new MeshBasicMaterial({ color: 0xFFFFFF });\n        const article = new Mesh(new BoxGeometry(1, 1, 0), [\n          whiteMat, whiteMat, whiteMat, whiteMat,\n          new MeshBasicMaterial({\n            map: articleTexture,\n          }),\n          whiteMat\n        ]);\n\n        const ratioArticle = articleTexture.image.width / articleTexture.image.height;\n        article.name = \"article\";\n        article.scale.set(this.settings?.article_scale, this.settings?.article_scale / ratioArticle, this.settings?.article_scale).multiplyScalar(.5);\n        articleGroup.position.z = -0.04;\n        articleGroup.position.x = 0.2;\n        articleGroup.add(article);\n\n        if (this.settings?.article_offset) {\n          articleGroup.position.x += this.settings?.article_offset;\n        }\n\n        // add interaction\n        const plane = new Mesh(new PlaneGeometry(1, 1), new MeshBasicMaterial({ transparent: true, color: \"#FF0000\", opacity: 0 }));\n        plane.name = \"click\";\n        plane.userData.x = plane.position.x;\n        plane.scale.set(.5, article.scale.y, 1);\n        plane.userData.endX = plane.position.x + ((article.scale.x / 2) - (plane.scale.x / 2));\n\n        this.interactiveMesh.click = plane;\n        articleGroup.add(plane);\n      }\n\n\n      //-- Add Sprite\n      if (!interfaceStore.state.supports.install && !interfaceStore.hasArticleInteract) {\n        const spriteTexture = loaderStore.getTexture(\"sprite-object\");\n        if (spriteTexture) {\n          this.prepareTexture(spriteTexture, false)\n\n          const ratioTexture = spriteTexture.image.width / spriteTexture.image.height;\n          const button = new Mesh(new PlaneGeometry(1, 1), new MeshBasicMaterial({ map: spriteTexture, transparent: true }));\n          button.name = \"clickButtton\";\n          button.scale.set(1, 1 / ratioTexture, 1).multiplyScalar(.5);\n          button.position.x = (model.scale.x / 2) + articleGroup.scale.x - 0.05\n          button.position.z = 0.07;\n          button.userData.scale = button.scale.clone().multiplyScalar(.5);\n          button.scale.set(0, 0, 0);\n          this.interactiveMesh.clickButtton = button;\n          this.container.add(button);\n        }\n      }\n    }\n\n    //-- Add Sprite\n    if (interfaceStore.state.supports.install && !interfaceStore.hasInteract) {\n      const spriteTexture = loaderStore.getTexture(\"touch-object\");\n      if (spriteTexture) {\n        this.prepareTexture(spriteTexture, false)\n\n        const ratioTexture = spriteTexture.image.width / spriteTexture.image.height;\n        const button = new Mesh(new PlaneGeometry(1, 1), new MeshBasicMaterial({ map: spriteTexture, transparent: true }));\n        button.name = \"picto\";\n        button.scale.set(1, 1 / ratioTexture, 1).multiplyScalar(.5);\n        button.position.x = (model.scale.x / 2) + this.interactiveMesh.disc!.scale.x + .3;\n        button.position.z = 0.03;\n        button.userData.scale = button.scale.clone().multiplyScalar(.5);\n        button.scale.set(0, 0, 0);\n        this.interactiveMesh.picto = button;\n        this.container.add(button);\n      }\n    }\n\n    //--- Add Lights\n    this.lights = {\n      ambient: new AmbientLight(0xffffff, 3),\n      directional: new DirectionalLight(0xFFFFFF, 1),\n    }\n\n    this.container.add(this.lights.ambient);\n    this.lights.directional.position.set(-3, 2, 7.5);\n    this.container.add(this.lights.directional);\n\n    emitter.emit(EVENTS.OBJECT_DETAIL_READY);\n\n    //save initial state of the orb controls\n    this.orbitDefaultState.target = this.orbitControls.target.clone();\n    this.orbitDefaultState.cam = this.getActiveCamera().position.clone();\n\n    gsap.timeline()\n      .from(this.container.rotation, {z:Math.PI / 4, x:-Math.PI / 2, ease:\"power4.inOut\", duration:2})\n\n    this.addEvents();\n  }\n\n  addEvents() {\n    mainWebGLRenderer?.domElement.addEventListener(\"pointerdown\", this.handlers.clickDown);\n    mainWebGLRenderer?.domElement.addEventListener(\"pointerup\", this.handlers.click);\n    mainWebGLRenderer?.domElement.addEventListener(\"pointermove\", this.handlers.move);\n  }\n\n  removeEvents() {\n    mainWebGLRenderer?.domElement.removeEventListener(\"pointerdown\", this.handlers.clickDown);\n    mainWebGLRenderer?.domElement.removeEventListener(\"pointerup\", this.handlers.click);\n    mainWebGLRenderer?.domElement.removeEventListener(\"pointermove\", this.handlers.move);\n  }\n\n  // Resize is called by default (by the plugin) when the scene is created\n  resize() {\n    // glScene.resize()\n    super.resize();\n  }\n\n  render(params: WebGLRenderParams) {\n\n    if (!this.scene.children.length) {\n      super.render(params);\n      this.build();\n    }\n    else {\n      super.render(params);\n\n      if (this.interactiveMesh.disc) {\n        damp(this.container.rotation, 'y', !this.status.toggle ? 0 : -Math.PI / 32, .2, params.delta);\n        damp(this.interactiveMesh.caseFront!.rotation, 'y', !this.status.toggle ? 0 : -Math.PI / 8, .2, params.delta);\n\n        if (this.moveArticle) {\n          if (this.interactiveMesh.article) {\n            damp(this.interactiveMesh.article.position, 'z', this.status.toggle ? 0.06 : -0.08, .25, params.delta);\n            damp(this.interactiveMesh.article.position, 'x', this.status.toggle ? (this.settings?.article_offset ?? 0) + 0.8 : (this.settings?.article_offset ?? 0) + 0.2, .25, params.delta);\n\n            damp(this.interactiveMesh.click!.position, 'x', this.status.toggle ? this.interactiveMesh.click!.userData.endX : this.interactiveMesh.click!.userData.x, .25, params.delta);\n          }\n\n          damp(this.interactiveMesh.disc.position, 'z', this.status.toggle ? -1 : 0, .25, params.delta);\n          damp(this.interactiveMesh.disc.position, 'x', this.status.toggle ? 0.1 : 0, .25, params.delta);\n        }\n      }\n    }\n\n    this.orbitControls.update();\n  }\n\n  dispose() {\n    // glScene.dispose()\n    // dispose every geometry and material for every Mesh children\n    this.disposeGeometries(this.container);\n    this.interactiveMesh = {};\n    super.dispose();\n    this.removeEvents();\n\n    document.body.style.cursor = 'default';\n  }\n\n  // Click Down\n  onClickDown(): void {\n    this.clickTimers.start = Date.now();\n    this.clickTimers.end = 0;\n    this.isDown = true;\n  }\n\n  // Click Up\n  onClick(e: MouseEvent): void {\n    this.clickTimers.end = Date.now();\n    this.isDown = false;\n\n    const isRealClick = this.clickTimers.end - this.clickTimers.start;\n    if (isRealClick <= DELAY_CLICK) {\n      if (this.settings?.article && this.interactiveMesh.article) {\n        this.getMousePosition(e);\n        this.checkIntersection(e, \"click\");\n      }\n    }\n  }\n\n  onMouseMove(e: PointerEvent): void {\n    if (interfaceStore.state.supports.install) {\n      this.userInteract();\n      return;\n    }\n\n    this.getMousePosition(e);\n\n    if (this.settings?.article && this.interactiveMesh.article) {\n      this.checkIntersection(e, \"move\");\n    }\n  }\n\n  // Get The Real Mouse Position with the offset position to the top left point\n  getMousePosition(evt: MouseEvent) {\n    const el = evt.currentTarget as HTMLElement;\n    const bounds = el.getBoundingClientRect();\n\n    let x = 0,\n      y = 0;\n\n    x = evt.clientX - bounds?.left;\n    y = evt.clientY - bounds?.top;\n\n    this.mouse.x = (x / mainWebGLRenderer!.domElement.offsetWidth) * 2 - 1;\n    this.mouse.y = -(y / mainWebGLRenderer!.domElement.offsetHeight) * 2 + 1;\n  }\n\n  show() {\n    this.container.visible = true;\n  }\n\n  toggleShowingInside(value: boolean) {\n    \n    this.status.toggle = value;\n\n    setTimeout(() => {\n      this.moveArticle = value;\n\n      if (this.status.toggle) {\n        if (this.interactiveMesh.clickButtton) {\n          if(!this.interactiveMesh.clickButtton.parent) {\n            this.container.add(this.interactiveMesh.clickButtton);\n          }\n\n          gsap.timeline()\n            .set(this.interactiveMesh.clickButtton!.scale, { x: 0, y: 0, z: 0 }, 0)\n            .to(this.interactiveMesh.clickButtton!.scale, { x: this.interactiveMesh.clickButtton?.userData.scale.x, y: this.interactiveMesh.clickButtton?.userData.scale.y, z: this.interactiveMesh.clickButtton?.userData.scale.z, ease: \"power4.out\", overwrite: false, duration: .5 }, .5)\n        }\n      }\n\n      if (this.interactiveMesh.picto) {\n        gsap.timeline()\n          .set(this.interactiveMesh.picto!.scale, { x: 0, y: 0, z: 0 }, 0)\n          .to(this.interactiveMesh.picto!.scale, { x: this.interactiveMesh.picto?.userData.scale.x, y: this.interactiveMesh.picto?.userData.scale.y, z: this.interactiveMesh.picto?.userData.scale.z, ease: \"power4.out\", overwrite: false, duration: .5 }, .5)\n      }\n    }, 400)\n  }\n\n  prepareTexture(tex: Texture | CompressedTexture, noMipmaps = true) {\n    tex.colorSpace = SRGBColorSpace;\n    if (noMipmaps) {\n      tex.generateMipmaps = false;\n      tex.minFilter = NearestFilter;\n    }\n  }\n\n  checkIntersection(e: MouseEvent, type: string = \"click\") {\n    if (this.status.reduce && !this.status.toggle) return;\n\n    this.raycaster.setFromCamera(this.mouse, this.getActiveCamera());\n\n    // calculate objects intersecting the picking ray\n    const intersection = this.raycaster.intersectObject(this.interactiveMesh.click as Mesh);\n    // calculate objects intersecting the picking ray\n    let intersectionButton = [];\n    if (this.interactiveMesh.clickButtton) {\n      intersectionButton = this.raycaster.intersectObject(this.interactiveMesh.clickButtton as Mesh);\n    }\n\n\n    //change body cursor\n    if (type === 'move') {\n      const hasIntersection = intersection.length > 0;\n      const hasIntersectionButton = intersectionButton.length > 0;\n      document.body.style.cursor = (hasIntersection || hasIntersectionButton) ? 'pointer' : 'default';\n\n      const article = this.interactiveMesh.article?.getObjectByName(\"article\") as Mesh;\n      if (article && !this.isDown) {\n        gsap.to(article.position, { x: hasIntersection ? 0.1 : 0, ease: \"power3.out\", duration: 1 });\n      }\n    }\n\n    //handle the click and reduce the scene\n    if (intersection.length && type === 'click') this.goMiniature();\n\n    if (intersectionButton.length && type === 'click') {\n      this.goMiniature()\n    }\n  }\n\n  // Reduce the scene\n  goMiniature() {\n    this.orbitControls.enabled = false;\n    this.status.reduce = true;\n    this.toggleShowingInside(false);\n\n    const article = this.interactiveMesh.article?.getObjectByName(\"article\") as Mesh;\n    const clickButtton = this.interactiveMesh.clickButtton?.getObjectByName(\"clickButtton\") as Mesh;\n    if (article) {\n      gsap.to(article.position, { x: 0, ease: \"power3.out\", duration: 1 });\n    }\n    if (clickButtton) {\n      interfaceStore.toggleArticleInteraction(true);\n\n      gsap.to(clickButtton.scale, { x: 0, y: 0, z: 0, ease: \"power3.out\", duration: .5, onComplete: () => {\n        clickButtton.parent?.remove(clickButtton);\n        this.interactiveMesh.clickButtton = undefined;\n      } });\n    }\n\n    document.body.style.cursor = \"default\";\n\n    const size = calculateUnitSize(20, this.camera as PerspectiveCamera);\n\n    gsap.timeline()\n      .to(this.getActiveCamera().position, { z: 20, x: this.orbitDefaultState.cam.x, y: this.orbitDefaultState.cam.y, ease: \"power4.inOut\", duration: 1.5 }, 0)\n      .to(this.orbitControls.target, { z: this.orbitDefaultState.target.z, y: this.orbitDefaultState.target.y, x: this.orbitDefaultState.target.x, ease: \"power4.inOut\", duration: 1.5 }, 0)\n      .to(this.container.position, {\n        x: -(size.width / 2) + (this.container.scale.x * .75),\n        y: (size.height / 2) - (this.container.scale.y * 1), ease: \"power4.inOut\", duration: 1.5\n      }, .25)\n      .add(() => {\n        const { width, height } = getPixelSize(this.container, this.camera);\n        emitter.emit(EVENTS.OBJECT_SHOW_ARTICLE, { width, height });\n      }, 1.5);\n\n    if (this.interactiveMesh.picto) {\n      this.userInteract();\n    }\n  }\n\n  // Revert to the interactive scene\n  revertToInteractive() {\n    gsap.timeline()\n      .to(this.getActiveCamera().position, { z: 3.5, ease: \"power4.inOut\", duration: 1.5 }, .25)\n      .to(this.container.position, {\n        x: -this.container.scale.x / 2,\n        y: 0, ease: \"power4.inOut\", duration: 1.5\n      }, 0)\n      .add(() => {\n        this.status.reduce = false;\n        this.toggleShowingInside(true);\n        this.orbitControls.enabled = true;\n      }, 1.3)\n  }\n\n  userInteract() {\n    if (!interfaceStore.hasInteract) {\n      interfaceStore.toggleInteraction(true);\n\n      if (this.interactiveMesh.picto) {\n        gsap.timeline({\n          onComplete: () => {\n            this.container.remove(this.interactiveMesh.picto!);\n            this.interactiveMesh.picto = undefined;\n          }\n        })\n          .to(this.interactiveMesh.picto!.scale, { x: 0, y: 0, z: 0, ease: \"power4.out\", duration: .5 }, 0)\n      }\n    }\n  }\n}\n\n"],"names":["DELAY_CLICK","CDScene","WebGLScene","options","__publicField","Vector2","mainWebGLRenderer","LinearToneMapping","Group","OrbitControls","Raycaster","model","loaderStore","child","size","Box3","Vector3","coverFront","_a","_b","frontMaterial","_d","BackSide","translucent","_e","translucentMaterial","newMat","MeshStandardMaterial","DoubleSide","coverBack","_f","_g","neutralMat","backMaterial","FrontSide","backMesh","Mesh","BoxGeometry","_i","_j","_k","articleGroup","isArray","_l","articleUrl","_m","_n","_o","articleTexture","whiteMat","MeshBasicMaterial","article","ratioArticle","_q","_r","_s","_t","_u","plane","PlaneGeometry","interfaceStore","spriteTexture","ratioTexture","button","AmbientLight","DirectionalLight","emitter","EVENTS","gsap","params","damp","e","evt","bounds","x","y","value","_c","tex","noMipmaps","SRGBColorSpace","NearestFilter","type","intersection","intersectionButton","hasIntersection","hasIntersectionButton","clickButtton","calculateUnitSize","width","height","getPixelSize"],"mappings":"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"}