var L=Object.defineProperty;var U=(d,n,e)=>n in d?L(d,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[n]=e;var g=(d,n,e)=>U(d,typeof n!="symbol"?n+"":n,e);import{g as _}from"./@debug-lodash-BIjirobg.js";import{bQ as R,cC as H,bT as B,f as S,bU as E,cl as N,q as k,al as A,bX as P,bV as X,bS as Y}from"./vendor-Dk7UPmZi.js";import{h as M,a as O,w as p,j as I,e as $,E as W}from"./app-i-894-h8.js";import{W as F,a as G}from"./easing-0f4db1c0.esm-DWmpH-gU.js";function q(d,n,e){return d===d&&(e!==void 0&&(d=d<=e?d:e),n!==void 0&&(d=d>=n?d:n)),d}var K=q,Q=K,z=R;function J(d,n,e){return e===void 0&&(e=n,n=void 0),e!==void 0&&(e=z(e),e=e===e?e:0),n!==void 0&&(n=z(n),n=n===n?n:0),Q(z(d),n,e)}var Z=J;const ee=_(Z),te=[{id:"foreground",width:2090,height:906,scale:1.42},{id:"sideLeft",width:1098,height:1956,scale:1.55},{id:"sideRight",width:1098,height:1956,scale:1.55},{id:"background",width:1783,height:1431,scale:1.73}],V=[{id:"box",width:794,height:503,scale:1.35},{id:"record",width:835,height:430,scale:1.4},{id:"partitions",width:670,height:360,scale:1},{id:"typewriter",width:790,height:524,scale:1.45},{id:"poster",width:353,height:407,scale:.9},{id:"carnet",width:292,height:430,scale:.8},{id:"livre",width:279,height:459,scale:1.1},{id:"violon",width:312,height:644,scale:1.8}],C=new X(1,1),se=new Y({transparent:!0});class ce extends F{constructor(e){super(e);g(this,"raycaster",new H);g(this,"isUserActive",!1);g(this,"userActivityTimeout",null);g(this,"resetTimeout",null);g(this,"sceneIndex");g(this,"handlers");g(this,"mouse",{x:0,y:0});g(this,"touchActive",!1);g(this,"disableClick",!1);g(this,"mouseOffset",{x:20,y:15});g(this,"name","LibraryScene");g(this,"touchTimers",{start:0,end:0,tap:!1});return this.resetUserActivity(),this.handlers={click:this.handleClick.bind(this),move:this.onMouseMove.bind(this),start:this.handleTouchStart.bind(this),end:this.onTouchEnd.bind(this),tmove:this.onTouchMove.bind(this)},this.sceneIndex=1,this}resetUserActivity(){this.isUserActive=!0,this.userActivityTimeout&&clearTimeout(this.userActivityTimeout),this.resetTimeout&&clearTimeout(this.resetTimeout),this.userActivityTimeout=setTimeout(()=>{this.isUserActive=!1,this.resetTimeout=setTimeout(()=>{this.isUserActive=!0},1e3)},3e4)}build(){const e=new B;e.name="mainGroup",e.position.z=0;const t=new B;t.name="foregroundGroup",t.userData.position=t.position.clone();const o=new B;o.name="leftSideGroup",o.userData.position=o.position.clone();const i=new B;i.name="rightSideGroup",i.userData.position=i.position.clone();const r=new B;r.name="backgroundGroup",r.userData.position=r.position.clone();const c=new B;c.name="groupObject",c.position.z=0,this.scene.add(e),this.scene.add(c),this.scene.add(r),this.scene.add(o),this.scene.add(i),this.scene.add(t);const u=["background","sideLeft","sideRight","foreground"],y=[{x:0,y:0,z:-5,scx:0,scy:.22},{x:-1,y:0,z:-2,scx:1.1,scy:.12},{x:1,y:0,z:-2,scx:-1.2,scy:.12},{x:0,y:-1,z:-1,scx:0,scy:1.22}];u.forEach((h,j)=>{const a=S(te,m=>m.id===h);if(a){const m=M.getTexture(a.id),x=se.clone();x.map=m,x.opacity=1,x.toneMapped=!1;const l=new E(C,x);l.userData.position_ref=y[j],l.name=a.id,l.userData.scale=a.scale,l.userData.isBase=!0,e.add(l),h==="foreground"&&t.add(l),h==="sideLeft"&&o.add(l),h==="sideRight"&&i.add(l),h==="background"&&r.add(l),l.userData.size={format:a.width>a.height?"paysage":"portrait",ratio:a.width>a.height?a.height/a.width:a.width/a.height}}});const b=["record","typewriter","partitions","carnet","poster","livre","violon","box"],f=[{x:-1.34,y:.05,z:-.9999},{x:2.6,y:.237,z:-.9999},{x:.11,y:.068,z:-.9999},{x:-.29,y:-.02,z:-1.9999},{x:1.6,y:1.02,z:-1.9999},{x:.016,y:1.04,z:-1.9999},{x:3.85,y:1.35,z:-4.9999},{x:-2.02,y:-.82,z:-.9999}],D=["253, 246, 250","253, 246, 250","253, 246, 250","253, 246, 250","253, 246, 250","253, 246, 250","253, 246, 250","253, 246, 250"];b.forEach((h,j)=>{const a=S(V,m=>m.id===h);if(a){const m=M.getTexture(a.id),x=M.getTexture(`${a.id}_glow`),l=new N({uniforms:{uTexture1:{value:m},uTexture2:{value:x},uHover:{value:0},uOpacity:{value:0}},vertexShader:`
            varying vec2 vUv;
            void main() {
              vUv = uv;
              gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
          `,fragmentShader:`
            uniform sampler2D uTexture1;
            uniform sampler2D uTexture2;
            uniform float uHover; // Uniform for hover effect
            varying vec2 vUv;

            void main() {
              vec4 tex1 = texture2D(uTexture1, vUv);
              vec4 tex2 = texture2D(uTexture2, vUv);
              vec4 glow = vec4(tex2.rgb, tex2.a * uHover); // Apply hover value to the glow texture

              // Apply gamma correction
              vec4 correctedTex1 = pow(tex1, vec4(2.2));
              vec4 correctedGlow = pow(glow, vec4(2.2));

              gl_FragColor = correctedTex1 + correctedGlow; // Overlay the glow texture on top of the base texture
              gl_FragColor = pow(gl_FragColor, vec4(1.0 / 2.2)); // Apply inverse gamma correction
            }
          `,transparent:!0}),s=new E(C,l);s.userData.position_ref=f[j],s.name=a.id,s.userData.bgColor=D[j],s.userData.scale=a.scale,(h==="box"||h==="record"||h==="partitions"||h==="typewriter")&&t.add(s),(h==="poster"||h==="carnet")&&o.add(s),h==="livre"&&i.add(s),h==="violon"&&r.add(s),s.userData.size={format:a.width>a.height?"paysage":"portrait",ratio:a.width>a.height?a.height/a.width:a.width/a.height},k.to(s.material.uniforms.uOpacity,{value:0,duration:1}),this.resize()}})}addEvents(){var e,t,o,i,r;(e=p)==null||e.domElement.addEventListener("click",this.handlers.click),(t=p)==null||t.domElement.addEventListener("mousemove",this.handlers.move),(o=p)==null||o.domElement.addEventListener("pointerdown",this.handlers.start),(i=p)==null||i.domElement.addEventListener("pointermove",this.handlers.tmove),(r=p)==null||r.domElement.addEventListener("pointerup",this.handlers.end)}removeEvents(){var e,t,o,i,r;(e=p)==null||e.domElement.removeEventListener("click",this.handlers.click),(t=p)==null||t.domElement.removeEventListener("mousemove",this.handlers.move),(o=p)==null||o.domElement.removeEventListener("pointerdown",this.handlers.start),(i=p)==null||i.domElement.removeEventListener("pointermove",this.handlers.tmove),(r=p)==null||r.domElement.removeEventListener("pointerup",this.handlers.end)}resizeGroup(e){A(e.children,t=>{const o=t.userData.isBase?this.sceneSize.height*t.userData.scale:t.userData.scale;if(t.userData.size.format==="paysage"?t.scale.set(o,o*t.userData.size.ratio,1):t.scale.set(o*t.userData.size.ratio,o,1),t.userData.isBase){let i=this.sceneSize.width*t.userData.position_ref.x+t.scale.x*t.userData.position_ref.scx;t.name==="sideRight"&&(i=Math.max(5,i)),t.name==="sideLeft"&&(i=Math.min(-5,i)),t.position.set(i,this.sceneSize.height*t.userData.position_ref.y+t.scale.y*t.userData.position_ref.scy,t.userData.position_ref.z)}else{const i=t.userData.position_ref;t.position.set(e.children[0].position.x+i.x,e.children[0].position.y+i.y,i.z)}t.userData.position=t.position.clone()})}resize(){if(super.resize(),!this.scene.children.length)this.build(),this.addEvents();else{const e=this.scene.getObjectByName("leftSideGroup"),t=this.scene.getObjectByName("rightSideGroup"),o=this.scene.getObjectByName("foregroundGroup"),i=this.scene.getObjectByName("backgroundGroup");A([e,t,o,i],c=>{this.resizeGroup(c)})}}render(e){super.render(e);const t=this.scene.getObjectByName("leftSideGroup"),o=this.scene.getObjectByName("rightSideGroup"),i=this.scene.getObjectByName("foregroundGroup"),r=this.scene.getObjectByName("backgroundGroup"),c=this.sceneSize.width/this.sceneSize.height;this.mouseOffset.x=c<16/10?140:20;const u=.5,y=this.mouse.x?this.mouse.x/(this.sceneSize.width/this.mouseOffset.x):0,b=.2;let f=this.mouse.y/(this.sceneSize.height/this.mouseOffset.y);f=ee(f,-b*2,b);const D=!this.isUserActive;let h=!1;const j=new P(this.mouse.x,this.mouse.y);if(this.raycaster.setFromCamera(j,this.camera),r&&r.children.length>0){const a=-(y*.01),m=-(f*.3);this.touchTimers.tap||G(r.position,[r.userData.position.x+a,r.userData.position.y+m,0],u,e.delta),["violon"].forEach(l=>{const s=r.getObjectByName(l);if(s){const T=s.material,v=this.raycaster.intersectObject(s),w=v.length>0||D?1:0;v.length>0&&!this.touchActive&&(h=!0),"hoverValue"in s.userData||(s.userData.hoverValue=0),(!O.hasTouch||this.touchTimers.tap)&&(s.userData.hoverValue+=(w-s.userData.hoverValue)*.1,T.uniforms.uHover.value=s.userData.hoverValue)}})}if(i&&i.children.length>0){const a=-(y*.1),m=-f;this.touchTimers.tap||G(i.position,[i.userData.position.x+a,i.userData.position.y+m,0],u,e.delta),["box","record","typewriter","partitions"].forEach(l=>{const s=i.getObjectByName(l);if(s){const T=s.material,v=this.raycaster.intersectObject(s),w=v.length>0||D?1:0;v.length>0&&!this.touchActive&&(h=!0),"hoverValue"in s.userData||(s.userData.hoverValue=0),(!O.hasTouch||this.touchTimers.tap)&&(s.userData.hoverValue+=(w-s.userData.hoverValue)*.1,T.uniforms.uHover.value=s.userData.hoverValue)}})}if(t&&t.children.length>0){const a=-(y*.05),m=-f*.7;this.touchTimers.tap||G(t.position,[t.userData.position.x+a,t.userData.position.y+m,0],u,e.delta),["poster","carnet"].forEach(l=>{const s=t.getObjectByName(l);if(s){const T=s.material,v=this.raycaster.intersectObject(s),w=v.length>0||D?1:0;v.length>0&&!this.touchActive&&(h=!0),"hoverValue"in s.userData||(s.userData.hoverValue=0),(!O.hasTouch||this.touchTimers.tap)&&(s.userData.hoverValue+=(w-s.userData.hoverValue)*.1,T.uniforms.uHover.value=s.userData.hoverValue)}})}if(o&&o.children.length>0){const a=-(y*.05),m=-f*.7;this.touchTimers.tap||G(o.position,[o.userData.position.x+a,o.userData.position.y+m,0],u,e.delta),["livre"].forEach(l=>{const s=o.getObjectByName(l);if(s){const T=s.material,v=this.raycaster.intersectObject(s),w=v.length>0||D?1:0;v.length>0&&!this.touchActive&&(h=!0),"hoverValue"in s.userData||(s.userData.hoverValue=0),(!O.hasTouch||this.touchTimers.tap)&&(s.userData.hoverValue+=(w-s.userData.hoverValue)*.1,T.uniforms.uHover.value=s.userData.hoverValue)}})}document.body.style.cursor=h?"pointer":"default"}dispose(){super.dispose(),this.removeEvents(),document.body.style.cursor="default"}getMousePosition(e){var c;const o=e.currentTarget.getBoundingClientRect();let i=0,r=0;e instanceof MouseEvent||e instanceof PointerEvent?(i=e.clientX-o.left,r=e.clientY-o.top):e instanceof TouchEvent&&((c=e.touches)==null?void 0:c.length)>0&&(i=e.touches[0].clientX-o.left,r=e.touches[0].clientY-o.top),this.mouse.x=i/p.domElement.offsetWidth*2-1,this.mouse.y=-(r/p.domElement.offsetHeight)*2+1}onMouseMove(e){this.getMousePosition(e),this.resetUserActivity()}handleTouchStart(e){O.hasTouch&&(this.touchActive=!0,e.preventDefault(),this.getMousePosition(e),this.resetUserActivity(),this.touchTimers.start=Date.now())}onTouchEnd(){if(!O.hasTouch)return;this.touchActive=!1,this.touchTimers.end=Date.now(),this.touchTimers.end-this.touchTimers.start<250&&(this.touchTimers.tap=!0,this.handleIntersections())}onTouchMove(e){O.hasTouch&&this.touchActive&&(this.getMousePosition(e),this.resetUserActivity())}handleClick(e){O.hasTouch||(this.getMousePosition(e),this.handleIntersections(),this.resetUserActivity())}handleIntersections(){const e=this.scene.getObjectByName("leftSideGroup"),t=this.scene.getObjectByName("rightSideGroup"),o=this.scene.getObjectByName("foregroundGroup"),i=this.scene.getObjectByName("backgroundGroup"),r=["record","typewriter","partitions","carnet","poster","livre","violon","box"];if(this.disableClick)return;let c;if(e&&t&&o&&i){const u=[...r.map(y=>{const b=S(V,D=>D.id===y);let f=null;return b&&(f=e.getObjectByName(b.id)||t.getObjectByName(b.id)||i.getObjectByName(b.id)||o.getObjectByName(b.id)),f&&f instanceof E&&f.material instanceof N?f:null})].filter(y=>y!==null);u.length>0&&(c=this.raycaster.intersectObjects(u))}if(c&&c.length>0){const u=c[0].object;this.fadeOutAndRedirect(u)}else this.touchTimers.tap=!1}fadeOutAndRedirect(e){const t=this.scene.getObjectByName("leftSideGroup"),o=this.scene.getObjectByName("rightSideGroup"),i=this.scene.getObjectByName("foregroundGroup"),r=this.scene.getObjectByName("backgroundGroup");if(I.disableApp(!0),this.disableClick=!0,t&&o&&i&&r){const c=[...t.children,...o.children,...i.children,...r.children].filter(u=>u instanceof E&&u.material instanceof N);k.timeline().to(c.map(u=>u instanceof E&&u.material instanceof N?u.material.uniforms.uOpacity:null).filter(u=>u!==null),{value:0,duration:1,stagger:.1,ease:"power2.out"}).to(e instanceof E&&e.material instanceof N?e.material.uniforms.uOpacity:null,{value:0,duration:1,ease:"power2.out"}).add(()=>{$.emit(W.CLICK_THEME,{name:e.name,bgColor:e.userData.bgColor})},1)}}exitFromMainHeader(e){let t;const o=this.scene.getObjectByName("leftSideGroup"),i=this.scene.getObjectByName("rightSideGroup"),r=this.scene.getObjectByName("foregroundGroup"),c=this.scene.getObjectByName("backgroundGroup");switch(e){case"/yannick-nezet-seguin/":t=r==null?void 0:r.getObjectByName("partitions");break;case"/charles-dutoit/":t=i==null?void 0:i.getObjectByName("livre");break;case"/universite-de-montreal/":t=o==null?void 0:o.getObjectByName("carnet");break;case"/metier-role-de-critique/":t=r==null?void 0:r.getObjectByName("typewriter");break;case"/les-raretes/":t=r==null?void 0:r.getObjectByName("box");break;case"/festival-de-lanaudiere/":t=c==null?void 0:c.getObjectByName("violon");break;case"/oeuvres-preferees/":t=r==null?void 0:r.getObjectByName("record");break;case"/maria-callas/":t=o==null?void 0:o.getObjectByName("poster");break}t&&this.fadeOutAndRedirect(t)}}export{ce as default};
//# sourceMappingURL=LibraryScene-C6j82wz9.js.map
