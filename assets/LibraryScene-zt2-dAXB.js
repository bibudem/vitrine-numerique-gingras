var R=Object.defineProperty;var H=(d,n,e)=>n in d?R(d,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[n]=e;var g=(d,n,e)=>H(d,typeof n!="symbol"?n+"":n,e);import{g as P}from"./@debug-lodash-BIjirobg.js";import{bT as X,cD as Y,q as M,bW as B,f as k,av as z,bX as T,cm as E,al as L,b_ as I,bY as $,bV as W}from"./vendor-D1O0VZ-0.js";import{j as S,h as C,y as p,a as G,e as F,E as q}from"./app-BHllM0oC.js";import{W as K,a as N,d as A}from"./easing-0f4db1c0.esm-CUoNLiYe.js";function J(d,n,e){return d===d&&(e!==void 0&&(d=d<=e?d:e),n!==void 0&&(d=d>=n?d:n)),d}var Q=J,Z=Q,V=X;function ee(d,n,e){return e===void 0&&(e=n,n=void 0),e!==void 0&&(e=V(e),e=e===e?e:0),n!==void 0&&(n=V(n),n=n===n?n:0),Z(V(d),n,e)}var te=ee;const se=P(te),ie=[{id:"foreground",width:2090,height:906,scale:1.42},{id:"sideLeft",width:1098,height:1956,scale:1.55},{id:"sideRight",width:1098,height:1956,scale:1.55},{id:"background",width:1783,height:1431,scale:1.73}],_=[{id:"box",width:794,height:503,scale:1.35},{id:"record",width:835,height:430,scale:1.4},{id:"partitions",width:670,height:360,scale:1},{id:"typewriter",width:790,height:524,scale:1.45},{id:"poster",width:353,height:407,scale:.9},{id:"carnet",width:292,height:430,scale:.8},{id:"livre",width:279,height:459,scale:1.1},{id:"violon",width:312,height:644,scale:1.8}],U=new $(1,1),oe=new W({transparent:!0});class ue extends K{constructor(e){super(e);g(this,"raycaster",new Y);g(this,"isUserActive",!1);g(this,"userActivityTimeout",null);g(this,"userActivityTl");g(this,"sceneIndex");g(this,"handlers");g(this,"mouse",{x:0,y:0});g(this,"touchActive",!1);g(this,"disableClick",!1);g(this,"mouseOffset",{x:20,y:15});g(this,"name","LibraryScene");g(this,"ready",!1);g(this,"touchTimers",{start:0,end:0,tap:!1});return this.handlers={click:this.handleClick.bind(this),move:this.onMouseMove.bind(this),start:this.handleTouchStart.bind(this),end:this.onTouchEnd.bind(this),tmove:this.onTouchMove.bind(this)},this.sceneIndex=1,this}stopUserActivity(){this.userActivityTl&&(this.userActivityTl.kill(),this.isUserActive=!0)}resetUserActivity(){this.isUserActive=!0,this.stopUserActivity(),!S.introSeen&&(this.userActivityTl=M.timeline({repeat:-1,repeatDelay:2,delay:3.5}).add(()=>{this.isUserActive=!1},0).add(()=>{this.isUserActive=!0},1))}build(){const e=new B;e.name="mainGroup",e.position.z=0;const t=new B;t.name="foregroundGroup",t.userData.position=t.position.clone();const i=new B;i.name="leftSideGroup",i.userData.position=i.position.clone();const s=new B;s.name="rightSideGroup",s.userData.position=s.position.clone();const o=new B;o.name="backgroundGroup",o.userData.position=o.position.clone();const h=new B;h.name="groupObject",h.position.z=0,this.scene.add(e),this.scene.add(h),this.scene.add(o),this.scene.add(i),this.scene.add(s),this.scene.add(t);const u=["background","sideLeft","sideRight","foreground"],b=[{x:0,y:0,z:-5,scx:0,scy:.22},{x:-1,y:0,z:-2,scx:1.1,scy:.12},{x:1,y:0,z:-2,scx:-1.2,scy:.12},{x:0,y:-1,z:-1,scx:0,scy:1.22}];u.forEach((c,D)=>{const r=k(ie,f=>f.id===c);if(r){const f=C.getTexture(r.id);f.colorSpace=z;const v=oe.clone();v.map=f,v.opacity=1,v.toneMapped=!1;const l=new T(U,v);l.userData.position_ref=b[D],l.name=r.id,l.userData.scale=r.scale,l.userData.isBase=!0,e.add(l),c==="foreground"&&t.add(l),c==="sideLeft"&&i.add(l),c==="sideRight"&&s.add(l),c==="background"&&o.add(l),l.userData.size={format:r.width>r.height?"paysage":"portrait",ratio:r.width>r.height?r.height/r.width:r.width/r.height}}});const x=["record","typewriter","partitions","carnet","poster","livre","violon","box"],m=[{x:-1.34,y:.05,z:-.9999},{x:2.6,y:.237,z:-.9999},{x:.11,y:.068,z:-.9999},{x:-.29,y:-.02,z:-1.9999},{x:1.6,y:1.02,z:-1.9999},{x:.016,y:1.04,z:-1.9999},{x:3.85,y:1.35,z:-4.9999},{x:-2.02,y:-.82,z:-.9999}],O=["253, 246, 250","253, 246, 250","253, 246, 250","253, 246, 250","253, 246, 250","253, 246, 250","253, 246, 250","253, 246, 250"];x.forEach((c,D)=>{const r=k(_,f=>f.id===c);if(r){const f=C.getTexture(r.id),v=C.getTexture(`${r.id}_glow`);f.colorSpace=z,v.colorSpace=z;const l=new E({uniforms:{uTexture1:{value:f},uTexture2:{value:v},uHover:{value:0},uOpacity:{value:0}},vertexShader:`
            varying vec2 vUv;
            void main() {
              vUv = uv;
              gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
          `,fragmentShader:`
          uniform sampler2D uTexture1;
          uniform sampler2D uTexture2;
          uniform float uHover; // Uniform for hover effect
          uniform float uOpacity; // global opacity
          varying vec2 vUv;

          void main() {
            vec4 tex1 = texture2D(uTexture1, vUv);
            vec4 tex2 = texture2D(uTexture2, vUv);
            vec4 glow = vec4(tex2.rgb, tex2.a * uHover); // Apply hover value to the glow texture

            // Apply gamma correction
            vec4 correctedTex1 = pow(tex1, vec4(2.2));
            vec4 correctedGlow = pow(glow, vec4(2.2));

            gl_FragColor = correctedTex1 + correctedGlow; // Overlay the glow texture on top of the base texture
            gl_FragColor = pow(gl_FragColor, vec4(1.0 / 2.2)); // Apply inverse gamma correction
            gl_FragColor.a *= uOpacity; // Apply global opacity
          }
        `,transparent:!0}),a=new T(U,l);a.userData.position_ref=m[D],a.name=r.id,a.userData.bgColor=O[D],a.userData.scale=r.scale,(c==="box"||c==="record"||c==="partitions"||c==="typewriter")&&t.add(a),(c==="poster"||c==="carnet")&&i.add(a),c==="livre"&&s.add(a),c==="violon"&&o.add(a),a.userData.size={format:r.width>r.height?"paysage":"portrait",ratio:r.width>r.height?r.height/r.width:r.width/r.height},M.to(a.material.uniforms.uOpacity,{value:1,duration:2,ease:"power4.out",delay:2+D*.15}),this.resize()}})}addEvents(){var e,t,i,s,o;(e=p)==null||e.domElement.addEventListener("click",this.handlers.click),(t=p)==null||t.domElement.addEventListener("mousemove",this.handlers.move),(i=p)==null||i.domElement.addEventListener("pointerdown",this.handlers.start),(s=p)==null||s.domElement.addEventListener("pointermove",this.handlers.tmove),(o=p)==null||o.domElement.addEventListener("pointerup",this.handlers.end)}removeEvents(){var e,t,i,s,o;(e=p)==null||e.domElement.removeEventListener("click",this.handlers.click),(t=p)==null||t.domElement.removeEventListener("mousemove",this.handlers.move),(i=p)==null||i.domElement.removeEventListener("pointerdown",this.handlers.start),(s=p)==null||s.domElement.removeEventListener("pointermove",this.handlers.tmove),(o=p)==null||o.domElement.removeEventListener("pointerup",this.handlers.end)}resizeGroup(e){L(e.children,t=>{const i=t.userData.isBase?this.sceneSize.height*t.userData.scale:t.userData.scale;if(t.userData.size.format==="paysage"?t.scale.set(i,i*t.userData.size.ratio,1):t.scale.set(i*t.userData.size.ratio,i,1),t.userData.isBase){let s=this.sceneSize.width*t.userData.position_ref.x+t.scale.x*t.userData.position_ref.scx;t.name==="sideRight"&&(s=Math.max(5,s)),t.name==="sideLeft"&&(s=Math.min(-5,s)),t.position.set(s,this.sceneSize.height*t.userData.position_ref.y+t.scale.y*t.userData.position_ref.scy,t.userData.position_ref.z)}else{const s=t.userData.position_ref;t.position.set(e.children[0].position.x+s.x,e.children[0].position.y+s.y,s.z)}t.userData.position=t.position.clone()})}resize(){if(super.resize(),!this.scene.children.length)this.build(),this.addEvents(),S.introSeen&&this.resetUserActivity();else{const e=this.scene.getObjectByName("leftSideGroup"),t=this.scene.getObjectByName("rightSideGroup"),i=this.scene.getObjectByName("foregroundGroup"),s=this.scene.getObjectByName("backgroundGroup");L([e,t,i,s],h=>{this.resizeGroup(h)})}}render(e){super.render(e);const t=this.scene.getObjectByName("leftSideGroup"),i=this.scene.getObjectByName("rightSideGroup"),s=this.scene.getObjectByName("foregroundGroup"),o=this.scene.getObjectByName("backgroundGroup"),h=this.sceneSize.width/this.sceneSize.height;this.mouseOffset.x=h<16/10?140:20;const u=.5,b=this.mouse.x?this.mouse.x/(this.sceneSize.width/this.mouseOffset.x):0,x=.2;let m=this.mouse.y/(this.sceneSize.height/this.mouseOffset.y);m=se(m,-x*2,x);const O=!this.isUserActive;let c=!1;const D=new I(this.mouse.x,this.mouse.y);if(this.raycaster.setFromCamera(D,this.camera),o&&o.children.length>0){const r=-(b*.01),f=-(m*.3);this.touchTimers.tap||N(o.position,[o.userData.position.x+r,o.userData.position.y+f,0],u,e.delta),["violon"].forEach(l=>{const a=o.getObjectByName(l);if(a){const w=a.material,y=this.raycaster.intersectObject(a),j=y.length>0||O?1:0;y.length>0&&!this.touchActive&&(c=!0),"hoverValue"in a.userData||(a.userData.hoverValue=0),A(a.userData,"hoverValue",j,.5,e.delta),w.uniforms.uHover.value=a.userData.hoverValue}})}if(s&&s.children.length>0){const r=-(b*.1),f=-m;this.touchTimers.tap||N(s.position,[s.userData.position.x+r,s.userData.position.y+f,0],u,e.delta),["box","record","typewriter","partitions"].forEach(l=>{const a=s.getObjectByName(l);if(a){const w=a.material,y=this.raycaster.intersectObject(a),j=y.length>0||O?1:0;y.length>0&&!this.touchActive&&(c=!0),"hoverValue"in a.userData||(a.userData.hoverValue=0),A(a.userData,"hoverValue",j,.5,e.delta),w.uniforms.uHover.value=a.userData.hoverValue}})}if(t&&t.children.length>0){const r=-(b*.05),f=-m*.7;this.touchTimers.tap||N(t.position,[t.userData.position.x+r,t.userData.position.y+f,0],u,e.delta),["poster","carnet"].forEach(l=>{const a=t.getObjectByName(l);if(a){const w=a.material,y=this.raycaster.intersectObject(a),j=y.length>0||O?1:0;y.length>0&&!this.touchActive&&(c=!0),"hoverValue"in a.userData||(a.userData.hoverValue=0),A(a.userData,"hoverValue",j,.5,e.delta),w.uniforms.uHover.value=a.userData.hoverValue}})}if(i&&i.children.length>0){const r=-(b*.05),f=-m*.7;this.touchTimers.tap||N(i.position,[i.userData.position.x+r,i.userData.position.y+f,0],u,e.delta),["livre"].forEach(l=>{const a=i.getObjectByName(l);if(a){const w=a.material,y=this.raycaster.intersectObject(a),j=y.length>0||O?1:0;y.length>0&&!this.touchActive&&(c=!0),"hoverValue"in a.userData||(a.userData.hoverValue=0),A(a.userData,"hoverValue",j,.5,e.delta),w.uniforms.uHover.value=a.userData.hoverValue}})}c&&this.ready&&this.stopUserActivity(),document.body.style.cursor=c?"pointer":"default"}dispose(){super.dispose(),this.removeEvents(),document.body.style.cursor="default"}getMousePosition(e){var h;const i=e.currentTarget.getBoundingClientRect();let s=0,o=0;e instanceof MouseEvent||e instanceof PointerEvent?(s=e.clientX-i.left,o=e.clientY-i.top):e instanceof TouchEvent&&((h=e.touches)==null?void 0:h.length)>0&&(s=e.touches[0].clientX-i.left,o=e.touches[0].clientY-i.top),this.mouse.x=s/p.domElement.offsetWidth*2-1,this.mouse.y=-(o/p.domElement.offsetHeight)*2+1}onMouseMove(e){this.getMousePosition(e)}handleTouchStart(e){G.hasTouch&&(this.touchActive=!0,e.preventDefault(),this.getMousePosition(e),this.touchTimers.start=Date.now())}onTouchEnd(){if(!G.hasTouch)return;this.touchActive=!1,this.touchTimers.end=Date.now(),this.touchTimers.end-this.touchTimers.start<250&&(this.touchTimers.tap=!0,this.handleIntersections())}onTouchMove(e){G.hasTouch&&this.touchActive&&(this.stopUserActivity(),this.getMousePosition(e))}handleClick(e){G.hasTouch||(this.getMousePosition(e),this.handleIntersections())}handleIntersections(){const e=this.scene.getObjectByName("leftSideGroup"),t=this.scene.getObjectByName("rightSideGroup"),i=this.scene.getObjectByName("foregroundGroup"),s=this.scene.getObjectByName("backgroundGroup"),o=["record","typewriter","partitions","carnet","poster","livre","violon","box"];if(this.disableClick)return;let h;if(e&&t&&i&&s){const u=[...o.map(b=>{const x=k(_,O=>O.id===b);let m=null;return x&&(m=e.getObjectByName(x.id)||t.getObjectByName(x.id)||s.getObjectByName(x.id)||i.getObjectByName(x.id)),m&&m instanceof T&&m.material instanceof E?m:null})].filter(b=>b!==null);u.length>0&&(h=this.raycaster.intersectObjects(u))}if(h&&h.length>0){const u=h[0].object;this.fadeOutAndRedirect(u)}else this.touchTimers.tap=!1}fadeOutAndRedirect(e){const t=this.scene.getObjectByName("leftSideGroup"),i=this.scene.getObjectByName("rightSideGroup"),s=this.scene.getObjectByName("foregroundGroup"),o=this.scene.getObjectByName("backgroundGroup");if(S.disableApp(!0),this.disableClick=!0,t&&i&&s&&o){const h=[...t.children,...i.children,...s.children,...o.children].filter(u=>u instanceof T&&u.material instanceof E);M.timeline().to(h.map(u=>u instanceof T&&u.material instanceof E?u.material.uniforms.uOpacity:null).filter(u=>u!==null),{value:0,duration:1,stagger:.1,ease:"power2.out"}).to(e instanceof T&&e.material instanceof E?e.material.uniforms.uOpacity:null,{value:0,duration:1,ease:"power2.out"}).add(()=>{F.emit(q.CLICK_THEME,{name:e.name,bgColor:e.userData.bgColor})},1)}}exitFromMainHeader(e){let t;const i=this.scene.getObjectByName("leftSideGroup"),s=this.scene.getObjectByName("rightSideGroup"),o=this.scene.getObjectByName("foregroundGroup"),h=this.scene.getObjectByName("backgroundGroup");switch(e){case"/yannick-nezet-seguin/":t=o==null?void 0:o.getObjectByName("partitions");break;case"/charles-dutoit/":t=s==null?void 0:s.getObjectByName("livre");break;case"/universite-de-montreal/":t=i==null?void 0:i.getObjectByName("carnet");break;case"/metier-role-de-critique/":t=o==null?void 0:o.getObjectByName("typewriter");break;case"/les-raretes/":t=o==null?void 0:o.getObjectByName("box");break;case"/festival-de-lanaudiere/":t=h==null?void 0:h.getObjectByName("violon");break;case"/oeuvres-preferees/":t=o==null?void 0:o.getObjectByName("record");break;case"/maria-callas/":t=i==null?void 0:i.getObjectByName("poster");break}t&&this.fadeOutAndRedirect(t)}setReady(){setTimeout(()=>{this.resetUserActivity(),this.ready=!0,S.setIntroSeen(!0)},500)}}export{ue as default};
//# sourceMappingURL=LibraryScene-zt2-dAXB.js.map
