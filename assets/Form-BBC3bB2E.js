import{cy as Fe,cz as Ie,cA as Re,bL as Me,d as _,aS as D,o as y,e as $,bn as Ce,Z as E,aU as k,aT as V,_ as W,g as w,b0 as q,a2 as ve,aY as F,aP as Ne,ay as ie,aQ as $e,r as A,b6 as ke,W as G,p as L,cB as ue,aL as z,q as de,ad as Le,S as Ue,bm as N,X as De,al as Y,a5 as ce,a6 as be,c as Q,ai as Be,aG as Ke,aF as Pe,aA as U,b2 as X}from"./vendor-D1O0VZ-0.js";import{g as x}from"./@debug-lodash-BIjirobg.js";import{v as He}from"./LocalStorage-DZutwCK5.js";import{i as S,_ as ee,s as Ve,c as We,F as Z,e as qe,E as Ge,m as me,K as ze,f as fe}from"./app-CKNy3kX0.js";import{a as Ye}from"./index-CBx3WDxD.js";import{F as p}from"./index-D4Mqis79.js";var Qe=Fe,Xe=1,Ze=4;function Je(e){return Qe(e,Xe|Ze)}var je=Je;const pe=x(je);function _e(e){return e&&e.length?e[0]:void 0}var xe=_e,et=xe;const J=x(et);var tt=Ie,at=Re,st=Me;function nt(e,t){var d={};return t=st(t),at(e,function(b,h,s){tt(d,t(b,h,s),b)}),d}var ot=nt;const lt=x(ot);function te(e){return e===void 0}function rt(e){return e===null}function it(e){return typeof e=="boolean"}function B(e){return e===Object(e)}function Se(e){return Array.isArray(e)}function ut(e){return e instanceof Date}function ye(e,t){return t?B(e)&&!te(e.uri):B(e)&&typeof e.size=="number"&&typeof e.type=="string"&&typeof e.slice=="function"}function dt(e,t){return ye(e,t)&&typeof e.name=="string"&&(B(e.lastModifiedDate)||typeof e.lastModified=="number")}function T(e){return te(e)?!1:e}function j(e,t,d,b){t=t||{},d=d||new FormData,t.indices=T(t.indices),t.nullsAsUndefineds=T(t.nullsAsUndefineds),t.booleansAsIntegers=T(t.booleansAsIntegers),t.allowEmptyArrays=T(t.allowEmptyArrays),t.noAttributesWithArrayNotation=T(t.noAttributesWithArrayNotation),t.noFilesWithArrayNotation=T(t.noFilesWithArrayNotation),t.dotsForObjectNotation=T(t.dotsForObjectNotation);const h=typeof d.getParts=="function";return te(e)||(rt(e)?t.nullsAsUndefineds||d.append(b,""):it(e)?t.booleansAsIntegers?d.append(b,e?1:0):d.append(b,e):Se(e)?e.length?e.forEach((s,f)=>{let u=b+"["+(t.indices?f:"")+"]";(t.noAttributesWithArrayNotation||t.noFilesWithArrayNotation&&dt(s,h))&&(u=b),j(s,t,d,u)}):t.allowEmptyArrays&&d.append(t.noAttributesWithArrayNotation?b:b+"[]",""):ut(e)?d.append(b,e.toISOString()):B(e)&&!ye(e,h)?Object.keys(e).forEach(s=>{const f=e[s];if(Se(f))for(;s.length>2&&s.lastIndexOf("[]")===s.length-2;)s=s.substring(0,s.length-2);const u=b?t.dotsForObjectNotation?b+"."+s:b+"["+s+"]":s;j(f,t,d,u)}):d.append(b,e)),d}var ct={serialize:j};const bt=_({name:"KoddeinSubmitUiButton",props:{ariaLabel:{type:String,default:S.global.t("FORMS.labels.submit")},label:{type:String,default:S.global.t("FORMS.labels.submit")},icon:{type:String,default:void 0},state:{type:String,default:null}}});function mt(e,t,d,b,h,s){const f=D("ui-button");return y(),$(f,{"data-state":e.state,tag:"button",theme:"primary",class:"KoddeinSubmit",label:e.label,icon:e.icon,"aria-label":e.ariaLabel,animated:!1},null,8,["data-state","label","icon","aria-label"])}const ft=ee(bt,[["render",mt],["__scopeId","data-v-747ddcb9"]]),pt=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24.71 23.57"><path d="M0,11.77H24" fill="none" stroke="currentColor"/><path d="M12.57,23.22l11.43-11.43L12.57,.35" fill="none" stroke="currentColor"/></svg>
`,St=`<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 29 29"><path d="M.5,14.5c0,7.73,6.27,14,14,14s14-6.27,14-14S22.23,.5,14.5,.5" fill="none" stroke="currentColor" stroke-linecap="round"/></svg>
`,vt=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 21.61 16.64"><path d="M.5,10.75l5.18,5.18L21.11,.5" fill="none" stroke="currentColor" stroke-linecap="round"/></svg>
`,yt=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
  <line x1="1" y1="15" x2="15" y2="1" stroke="currentColor"/>
  <line x1="1" y1="1" x2="15" y2="15" stroke="currentColor"/>
</svg>
`,ht=_({name:"KoddeinSubmit",props:{ariaLabel:{type:String,default:S.global.t("FORMS.standard.submit button")},label:{type:String,default:S.global.t("FORMS.standard.submit")}},setup(){return{status:Ce("status"),FORM_STATUS:p,IconSubmit:pt,IconSending:St,IconSuccess:vt,IconError:yt}}}),gt=["data-state","aria-label"],Ot={class:"wrapper"},wt=["innerHTML"],Tt=["innerHTML"],Et=["innerHTML"],At=["textContent"],Ft=["innerHTML"];function It(e,t,d,b,h,s){return y(),E("button",{"data-state":e.status.value.value,type:"submit",class:"KoddeinSubmit","aria-label":e.ariaLabel},[k("span",Ot,[V(q,{name:"fade"},{default:W(()=>[e.status.value.value===e.FORM_STATUS.SENDING?(y(),E("i",{key:0,class:"icon -sending",innerHTML:e.IconSending},null,8,wt)):w("",!0)]),_:1}),V(q,{name:"fade"},{default:W(()=>[e.status.value.value===e.FORM_STATUS.SUCCESS?(y(),E("i",{key:0,class:"icon -success",innerHTML:e.IconSuccess},null,8,Tt)):w("",!0)]),_:1}),V(q,{name:"fade"},{default:W(()=>[e.status.value.value===e.FORM_STATUS.ERROR?(y(),E("i",{key:0,class:"icon -error",innerHTML:e.IconError},null,8,Et)):w("",!0)]),_:1}),k("span",{class:"text",textContent:ve(e.label)},null,8,At),k("i",{class:F(`icon -submit ${e.status.value.value===e.FORM_STATUS.PRISTINE||e.status.value.value===e.FORM_STATUS.DEFAULT||e.status.value.value===e.FORM_STATUS.INVALID?"":"-hidden"}`),innerHTML:e.IconSubmit},null,10,Ft)])],8,gt)}const Rt=ee(ht,[["render",It],["__scopeId","data-v-239f0874"]]),Mt=_({name:"KoddeinForm",components:{Submit:ft,SubmitIcon:Rt},props:{theme:{type:String,default:"default"},steps:{type:Number,default:1},action:{type:String,default:""},method:{type:String,default:"post"},model:{type:Object,default:void 0},labels:{type:Object,default:null},icons:{type:Object,default:null},onSend:{type:Function,default:void 0},debug:{type:Object,default:void 0},recaptcha:{type:Boolean,default:!0},flash:{type:Boolean,default:!0},reset:{type:Boolean,default:!0},animated:{type:Boolean,default:!1},submitIcon:{type:Boolean,default:!1}},emits:["update","status","changeStep","errorValidation","success","error"],setup(e,{emit:t}){const{t:d}=Ne(),{scrollable:b}=ie(Ve.state),h=$e("el",null);let s=A(1),f=A(1),u=A(p.PRISTINE),I=A(!1),g=A({});const ae=A(!e.animated),se=ke({submit:void 0,next:void 0,prev:void 0}),K=We&&Z("VITE_RECAPTCHA_ENABLED")&&Z("VITE_RECAPTCHA_CLIENT_KEY")?Z("VITE_RECAPTCHA_CLIENT_KEY"):null;G(g,a=>{const o=Te(a);t("update",o)}),G(u,a=>{t("status",a)},{immediate:!0}),G(s,a=>{L(()=>{Ee(a,se,e.steps),t("changeStep"),le()})},{immediate:!0});let P=()=>{};if(K){const{executeRecaptcha:a,recaptchaLoaded:o}=ue();P=async()=>{await o();const n=await a("form");oe(n)}}const H=()=>{g.value={},u.value=p.DEFAULT},he=()=>{g.value={},u.value=p.PRISTINE;const a=z({},e.model);Y(a,o=>{o.value=null}),f.value=s.value,s.value=1,t("update",a)},ge=()=>{if(K){const{executeRecaptcha:a,recaptchaLoaded:o}=ue();return P=async()=>(await o(),await a("form"))}return!1},Oe=()=>{s.value>1&&(H(),f.value=s.value,s.value-=1)},we=()=>{var a;e.steps&&e.steps>1&&s.value<e.steps&&ne(!1,(a=e.debug)==null?void 0:a.validation)&&(H(),f.value=s.value,s.value+=1)},Te=a=>{const o=z({},e.model);return lt(a,(n,l)=>{if(n.length){let c=J(n);if(c){const i=J(n);if(typeof i=="string"){const r=`FORMS.errors.${i}`,m=S.global.t?S.global.t(r):"";m!==""&&r!==m&&(c=m)}else{const r=`FORMS.errors.${i.label}`,m=S.global.t?S.global.t(r,i.attr):"";m!==""&&r!==m&&(c=m)}}o[l].error=c}else o[l].error=""}),o},ne=(a=!1,o=!1)=>{if(o)return!0;const n=pe(e.model);a||Y(n,(i,r)=>{var m;((m=h.value)==null?void 0:m.querySelector(`[data-name='${r}']`))===null&&n&&n[r]&&delete n[r]});const l=ce(be(n),Q(n,i=>Be(Q(i.validations,r=>r(i.value,i,n)),null,void 0,!0)));g.value=l;const c=Ke(He(l)).length<=0;return c||L(()=>{u.value=p.INVALID}),c},Ee=(a,o,n)=>{var m,R,O;if(e.steps===1)return;const l=de.timeline({onStart:()=>{I.value=!0},onComplete:()=>{I.value=!1,qe.emit(Ge.CURSOR_UPDATE)}}),c=(m=o.submit)==null?void 0:m.$el,i=(R=o.next)==null?void 0:R.$el,r=(O=o.prev)==null?void 0:O.$el;a===1?(r&&l.to(r,.2,{opacity:0,ease:"power1.easeOut"},"0"),c&&l.to(c,.2,{opacity:0,ease:"power1.easeOut"},"0"),i&&l.to(i,.2,{opacity:0,ease:"power1.easeOut"},"0"),i&&l.to(i,.2,{opacity:1,ease:"power1.easeOut"},"1.4")):n&&a===n?(i&&l.to(i,.2,{opacity:0,ease:"power1.easeOut"},"0"),r&&l.to(r,.2,{opacity:0,ease:"power1.easeOut"},"0"),r&&l.to(r,.2,{opacity:1,ease:"power1.easeOut"},"1.4"),c&&l.to(c,.2,{opacity:1,ease:"power1.easeOut"},"1.4")):(c&&l.to(c,.2,{opacity:0,ease:"power1.easeOut"},"0"),i&&l.to(i,.2,{opacity:0,ease:"power1.easeOut"},"0"),i&&l.to(i,.2,{opacity:1,ease:"power1.easeOut"},"1.4"),r&&l.to(r,.2,{opacity:0,ease:"power1.easeOut"},"0"),r&&l.to(r,.2,{opacity:1,ease:"power1.easeOut"},"1.4"))},Ae=()=>{var a;u.value===p.SUCCESS||u.value===p.SENDING||(g.value={},u.value=p.DEFAULT,ne(!0,(a=e.debug)==null?void 0:a.validation)?e.recaptcha&&K?P():oe():t("errorValidation"))},oe=a=>new Promise((o,n)=>{if(!e.action&&!e.onSend&&n(new Error("Form send without action. either add action or override this `send` method")),u.value=p.SENDING,e.onSend)return o(e.onSend(a));if(e.action){const l=ce(be(e.model),Q(e.model,({value:i})=>i)),c=z({},{data:ct.serialize(l),method:e.method||"post",url:e.action,headers:{},showErrorMessage:e.flash});return a&&e.recaptcha&&c.headers&&(c.headers["recaptcha-token"]=a),o(Ye.request(c))}return n(new Error("@todo Ui/Form : auto send if action prop"))}).then(o=>(u.value=p.SUCCESS,t("success",o),e.flash&&ze.ADD({status:"success",title:e.labels&&e.labels.success?e.labels.success:S.global.t("FORMS.labels.success"),important:!1,duration:2e4}),e.reset?setTimeout(()=>{he()},6e3):u.value=p.PRISTINE,o)).catch(o=>{var m,R;if(o.message==="just-ignore-this")return;const{response:n}=o,l=(()=>{var v,M,C;const O=(M=(v=n==null?void 0:n.data)==null?void 0:v.data)==null?void 0:M.message;return O&&S.global.te(`FORMS.errors.${O}`,(C=fe.locale)==null?void 0:C.i18n)?S.global.t(`FORMS.errors.${O}`):S.global.t("FORMS.errors.generic")})(),c=((R=(m=n==null?void 0:n.data)==null?void 0:m.meta)==null?void 0:R.errors)??{},i=O=>{var C;let v=J(O);if(v.search("ne peut Ãªtre vide")>=0||v.search("is required")>=0||v.search("required")>=0)return S.global.t("FORMS.errors.required");const M=`FORMS.errors.${v.replace(/\./g,"")}`;return S.global.te(M,(C=fe.locale)==null?void 0:C.i18n)&&(v=S.global.t(M)),v},r=pe(e.model);Y(c,(O,v)=>{!r||!r[v]||(r[v].error=i(O))}),Pe(c)||t("update",r),u.value=p.ERROR,g.value.generic=l,t("error",l),setTimeout(()=>{H()},6e3)}),le=async()=>{me&&e.animated&&(await Le(b).toBe(!0),L(()=>{var n;const a=(n=h.value)==null?void 0:n.querySelectorAll(".koddein-field, .actions"),o=Ue.create({trigger:h.value,start:"top bottom",end:"bottom top",onToggle:({isActive:l})=>{ae.value=l,l&&(a&&de.to(a,{opacity:1,stagger:.08,duration:.4,delay:.3}),L(()=>{o.kill()}))}})}))},re=()=>{u.value===p.PRISTINE&&(u.value=p.DEFAULT)};return le(),N("theme",e.theme),N("currentStep",s),N("previousStep",f),N("status",{value:De(u),update:re}),N("errors",g),{t:d,...ie(se),visible:ae,motion:me,currentStep:s,previousStep:f,status:u,locked:I,errors:g,FORM_STATUS:p,onNext:we,onPrev:Oe,onSubmit:Ae,executeRecaptcha:ge,updateStatus:re}}}),Ct=["method","action","disabled","data-status","data-theme","data-visible","data-animated"],Nt={class:"wrapper"},$t={class:F(["actions"])},kt=["textContent"],Lt=["innerHTML"];function Ut(e,t,d,b,h,s){const f=D("ui-button"),u=D("SubmitIcon"),I=D("Submit");return y(),E("form",{ref:"el",method:e.method,action:e.action,disabled:e.status===e.FORM_STATUS.SENDING,"data-status":e.status,"data-theme":e.theme,class:"koddein-form",novalidate:"","data-visible":e.visible,"data-animated":e.animated&&e.motion,onSubmit:t[2]||(t[2]=X((...g)=>e.onSubmit&&e.onSubmit(...g),["prevent"]))},[k("div",Nt,[U(e.$slots,"default",{},void 0,!0)]),U(e.$slots,"actions",{},()=>[k("div",$t,[e.steps&&e.steps>1?(y(),$(f,{key:0,ref:"prev",tag:"span",class:F(["button -prev",e.currentStep>1?"-active":""]),theme:"secondary",label:e.labels&&e.labels.prev?e.labels.prev:e.t("FORMS.labels.prev"),tabindex:"0",icon:e.icons&&e.icons.prev?e.icons.prev:void 0,onClick:t[0]||(t[0]=X(()=>{e.locked||e.onPrev()},["prevent"]))},null,8,["class","label","icon"])):w("",!0),e.steps&&e.steps>1?(y(),$(f,{key:1,ref:"next",tag:"span",class:F(["button -next",e.currentStep<e.steps?"-active":""]),theme:"secondary",label:e.labels&&e.labels.next?e.labels.next:e.t("FORMS.labels.next"),icon:e.icons&&e.icons.next?e.icons.next:void 0,onClick:t[1]||(t[1]=X(()=>{e.locked||e.onNext()},["prevent"]))},null,8,["class","label","icon"])):w("",!0),e.submitIcon?(y(),$(u,{key:2,ref:"submit",class:F(["button -submit",e.steps&&e.currentStep===e.steps?"-active":""]),label:e.labels&&e.labels.submit?e.labels.submit:e.t("FORMS.labels.submit"),icon:e.icons&&e.icons.submit?e.icons.submit:void 0,state:e.status},null,8,["class","label","icon","state"])):(y(),$(I,{key:3,ref:"submit",class:F(["button -submit",e.steps&&e.currentStep===e.steps?"-active":""]),label:e.labels&&e.labels.submit?e.labels.submit:e.t("FORMS.labels.submit"),icon:e.icons&&e.icons.submit?e.icons.submit:void 0,state:e.status},null,8,["class","label","icon","state"]))])],!0),e.flash?w("",!0):U(e.$slots,"success",{key:0},()=>[e.status===e.FORM_STATUS.SUCCESS?(y(),E("p",{key:0,class:"success",textContent:ve(e.labels&&e.labels.success||e.t("FORMS.labels.success"))},null,8,kt)):w("",!0)],!0),e.flash?w("",!0):U(e.$slots,"errors",{key:1},()=>[e.errors&&e.errors.generic?(y(),E("p",{key:0,class:"errors -generic",innerHTML:e.labels&&e.labels.error||e.errors.generic},null,8,Lt)):w("",!0)],!0)],40,Ct)}const Wt=ee(Mt,[["render",Ut],["__scopeId","data-v-557ab753"]]);export{Wt as default};
//# sourceMappingURL=Form-BBC3bB2E.js.map
