var j=Object.defineProperty;var N=(m,d,e)=>d in m?j(m,d,{enumerable:!0,configurable:!0,writable:!0,value:e}):m[d]=e;var a=(m,d,e)=>N(m,typeof d!="symbol"?d+"":d,e);import{w as o,h as w,e as V,E as Y}from"./app-i-894-h8.js";import{W as q,d as r}from"./easing-0f4db1c0.esm-DWmpH-gU.js";import{cD as F,cG as g,bX as H,cE as X,bT as O,cF as J,cC as K,bU as u,bV as U,bS as Z,cH as Q,cI as $,q as _,av as ee,au as te}from"./vendor-Dk7UPmZi.js";import{O as se,R as ie}from"./RoomEnvironment-Cuz8oAXf.js";import"./@debug-lodash-BIjirobg.js";const ne=350,k=new F(1,1,1),c=new g({color:0,roughness:.5,metalness:.5}),h=new g({color:16777215,roughness:.5,metalness:.5});class de extends q{constructor(e){var t,i;super(e);a(this,"handlers");a(this,"mouse",new H);a(this,"raycaster");a(this,"container");a(this,"interactiveMesh",{});a(this,"lights",{});a(this,"clickTimers",{start:0,end:0});a(this,"isDown",!1);a(this,"ready",!1);a(this,"showButton",!1);a(this,"status",{toggle:!1});a(this,"orbitControls");a(this,"pmremGenerator");return o.toneMapping=X,this.handlers={clickDown:this.onClickDown.bind(this),click:this.onClick.bind(this),move:this.onMouseMove.bind(this)},((t=this.settings)==null?void 0:t.tranche).charAt(0)==="#"&&c.color.setStyle((i=this.settings)==null?void 0:i.tranche),this.container=new O,this.container.position.z=-.5,this.container.visible=!1,this.orbitControls=new se(this.getActiveCamera(),o.domElement),this.orbitControls.enableDamping=!0,this.orbitControls.enablePan=!1,this.orbitControls.dampingFactor=.1,this.orbitControls.enableZoom=!1,this.pmremGenerator=new J(o),this.pmremGenerator.compileEquirectangularShader(),this.scene.environment=this.pmremGenerator.fromScene(new ie).texture,this.scene.environmentIntensity=.25,this.raycaster=new K,this}async build(){var C,E,L,D,T,z,R,S,G,I,A,B,P;this.scene.add(this.container);const e=new O;this.interactiveMesh.front=e,this.container.add(this.interactiveMesh.front);const t=await((L=w.getLoader("texture"))==null?void 0:L.loadAsync(((C=this.settings)==null?void 0:C.folder)+((E=this.settings)==null?void 0:E.recto)));t&&this.prepareTexture(t);const i=(t==null?void 0:t.image.width)/(t==null?void 0:t.image.height),s=new u(k,[c,c,c,c,new g({map:t,roughness:.5,metalness:.5}),c]);s.name="frontCover",s.scale.set(2,2/i,.02),s.position.x=s.scale.x/2,e.add(s),e.position.x=-s.position.x;const n=new u(k,new g({color:(D=this.settings)==null?void 0:D.tranche,roughness:.5,metalness:.5}));n.scale.set(.1,s.scale.y,.02),n.rotation.y=Math.PI/2,n.position.set(-s.scale.x/2,0,-n.scale.x/2),this.interactiveMesh.tranche=n,this.container.add(this.interactiveMesh.tranche);const p=await((R=w.getLoader("texture"))==null?void 0:R.loadAsync(((T=this.settings)==null?void 0:T.folder)+((z=this.settings)==null?void 0:z.verso)));p&&this.prepareTexture(p);const v=new u(k,[c,c,c,c,c,new g({map:p,roughness:.5,metalness:.5})]);v.scale.copy(s.scale),v.position.set(0,0,-n.scale.x),this.interactiveMesh.back=v,this.container.add(this.interactiveMesh.back);const y=await((I=w.getLoader("texture"))==null?void 0:I.loadAsync(((S=this.settings)==null?void 0:S.folder)+((G=this.settings)==null?void 0:G.page_1)));y&&this.prepareTexture(y);const f=new u(k,[h,h,h,h,new g({map:y,roughness:.5,metalness:.5}),h]);f.scale.set(s.scale.x,s.scale.y*.98,.05),f.position.z=-n.scale.x/2-.02,f.position.x=0,this.interactiveMesh.pageRight=f,this.container.add(this.interactiveMesh.pageRight);const b=await((P=w.getLoader("texture"))==null?void 0:P.loadAsync(((A=this.settings)==null?void 0:A.folder)+((B=this.settings)==null?void 0:B.page_2)));b&&this.prepareTexture(b);const M=new u(k,[h,h,h,h,h,new g({map:b,roughness:.5,metalness:.5})]);M.scale.copy(f.scale),M.position.z=n.scale.x/2-.08,M.position.x=M.scale.x/2,this.interactiveMesh.pageLeft=M,e.add(this.interactiveMesh.pageLeft);const x=w.getTexture("sprite-object");if(x){this.prepareTexture(x,!1);const W=x.image.width/x.image.height,l=new u(new U(1,1),new Z({map:x,transparent:!0}));l.name="click",l.scale.set(1,1/W,1).multiplyScalar(.5),l.position.x=s.scale.x/2,l.position.z=.03,l.userData.scale=l.scale.clone(),l.scale.set(0,0,0),this.interactiveMesh.click=l,this.container.add(l)}this.lights={ambient:new Q(16777215,3),directional:new $(16777215,1)},this.container.add(this.lights.ambient),this.lights.directional.position.set(-3,2,7.5),this.container.add(this.lights.directional),V.emit(Y.OBJECT_DETAIL_READY),this.ready=!0,this.addEvents()}addEvents(){var e,t,i;(e=o)==null||e.domElement.addEventListener("pointerdown",this.handlers.clickDown),(t=o)==null||t.domElement.addEventListener("pointerup",this.handlers.click),(i=o)==null||i.domElement.addEventListener("mousemove",this.handlers.move)}removeEvents(){var e,t,i;(e=o)==null||e.domElement.removeEventListener("pointerdown",this.handlers.clickDown),(t=o)==null||t.domElement.removeEventListener("pointerup",this.handlers.click),(i=o)==null||i.domElement.removeEventListener("mousemove",this.handlers.move)}resize(){super.resize()}render(e){var t;if(!this.scene.children.length)super.render(e),this.build();else if(super.render(e),this.ready){const i=(t=this.interactiveMesh.front)==null?void 0:t.getObjectByName("frontCover"),s=this.interactiveMesh.tranche;r(this.interactiveMesh.front.rotation,"y",this.status.toggle?-Math.PI:0,.2,e.delta),r(this.interactiveMesh.front.position,"x",this.status.toggle?-i.scale.x/2-s.scale.x:-i.scale.x/2,.2,e.delta),r(this.interactiveMesh.front.position,"z",this.status.toggle?-s.scale.x:0,.2,e.delta),r(this.interactiveMesh.tranche.rotation,"y",this.status.toggle?0:Math.PI/2,.2,e.delta),r(this.interactiveMesh.tranche.position,"x",this.status.toggle?-i.scale.x/2-s.scale.x/2:-i.scale.x/2,.2,e.delta),r(this.interactiveMesh.tranche.position,"z",this.status.toggle?-s.scale.x:-(s.scale.x/2),.2,e.delta),r(this.interactiveMesh.pageRight.position,"x",this.status.toggle?-s.scale.x/2+.02:0,.2,e.delta),r(this.interactiveMesh.pageLeft.position,"x",this.status.toggle?this.interactiveMesh.pageLeft.scale.x/2-s.scale.x/2:this.interactiveMesh.pageLeft.scale.x/2,.2,e.delta),r(this.interactiveMesh.pageRight.scale,"z",this.status.toggle?.02:.05,.2,e.delta),r(this.interactiveMesh.pageLeft.scale,"z",this.status.toggle?.02:.05,.2,e.delta),r(this.container.position,"x",this.status.toggle?this.container.scale.x:0,.2,e.delta)}this.raycaster.setFromCamera(this.mouse,this.getActiveCamera()),this.orbitControls.update()}dispose(){this.disposeGeometries(this.container),this.interactiveMesh={},super.dispose(),this.removeEvents(),document.body.style.cursor="default"}onClickDown(){this.clickTimers.start=Date.now(),this.clickTimers.end=0,this.isDown=!0}onClick(e){this.clickTimers.end=Date.now(),this.isDown=!1,this.clickTimers.end-this.clickTimers.start<=ne&&this.interactiveMesh.front&&this.checkIntersection(e,"click")}onMouseMove(e){this.getMousePosition(e),this.interactiveMesh.front&&this.checkIntersection(e,"move")}getMousePosition(e){const i=e.currentTarget.getBoundingClientRect();let s=0,n=0;s=e.clientX-(i==null?void 0:i.left),n=e.clientY-(i==null?void 0:i.top),this.mouse.x=s/o.domElement.offsetWidth*2-1,this.mouse.y=-(n/o.domElement.offsetHeight)*2+1}show(){this.container.visible=!0}toggleShowingInside(e){var t,i,s;e&&_.timeline().set(this.interactiveMesh.click.scale,{x:0,y:0,z:0},0).to(this.interactiveMesh.click.scale,{x:(t=this.interactiveMesh.click)==null?void 0:t.userData.scale.x,y:(i=this.interactiveMesh.click)==null?void 0:i.userData.scale.y,z:(s=this.interactiveMesh.click)==null?void 0:s.userData.scale.z,ease:"power4.out",overwrite:!1,duration:.5},.5)}prepareTexture(e,t=!0){e.colorSpace=ee,t&&(e.generateMipmaps=!1,e.minFilter=te)}checkIntersection(e,t="click"){var s,n,p;const i=this.raycaster.intersectObject(this.interactiveMesh.click);if(t==="move"){const v=i.length>0;document.body.style.cursor=v?"pointer":"default"}i.length&&t==="click"&&(this.status.toggle=!this.status.toggle,_.timeline().to(this.interactiveMesh.click.scale,{x:0,y:0,z:0,ease:"power4.out",duration:.5},0).to(this.interactiveMesh.click.scale,{x:(s=this.interactiveMesh.click)==null?void 0:s.userData.scale.x,y:(n=this.interactiveMesh.click)==null?void 0:n.userData.scale.y,z:(p=this.interactiveMesh.click)==null?void 0:p.userData.scale.z,ease:"power4.out",overwrite:!1,duration:.5},1))}revertToInteractive(){}}export{de as BookScene};
//# sourceMappingURL=BookScene-AWSC41Zl.js.map
