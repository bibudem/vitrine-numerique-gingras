var L=Object.defineProperty;var U=(l,c,e)=>c in l?L(l,c,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[c]=e;var g=(l,c,e)=>U(l,typeof c!="symbol"?c+"":c,e);import{g as _}from"./@debug-lodash-BIjirobg.js";import{bQ as R,cC as H,bT as j,f as S,bU as B,cl as E,q as k,al as A,bX as P,bV as X,bS as Y}from"./vendor-Dk7UPmZi.js";import{h as M,a as N,w as v,j as I,e as $,E as W}from"./app-8gBICEsG.js";import{W as F,a as G}from"./easing-0f4db1c0.esm-BEMtKdpm.js";function q(l,c,e){return l===l&&(e!==void 0&&(l=l<=e?l:e),c!==void 0&&(l=l>=c?l:c)),l}var K=q,Q=K,z=R;function J(l,c,e){return e===void 0&&(e=c,c=void 0),e!==void 0&&(e=z(e),e=e===e?e:0),c!==void 0&&(c=z(c),c=c===c?c:0),Q(z(l),c,e)}var Z=J;const ee=_(Z),te=[{id:"foreground",width:2090,height:906,scale:1.42},{id:"sideLeft",width:1098,height:1956,scale:1.55},{id:"sideRight",width:1098,height:1956,scale:1.55},{id:"background",width:1783,height:1431,scale:1.73}],V=[{id:"box",width:794,height:503,scale:1.35},{id:"record",width:835,height:430,scale:1.4},{id:"partitions",width:670,height:360,scale:1},{id:"typewriter",width:790,height:524,scale:1.45},{id:"poster",width:353,height:407,scale:.9},{id:"carnet",width:292,height:430,scale:.8},{id:"livre",width:279,height:459,scale:1.1},{id:"violon",width:312,height:644,scale:1.8}],C=new X(1,1),se=new Y({transparent:!0});class ce extends F{constructor(e){super(e);g(this,"raycaster",new H);g(this,"isUserActive",!1);g(this,"userActivityTimeout",null);g(this,"resetTimeout",null);g(this,"sceneIndex");g(this,"handlers");g(this,"mouse",{x:0,y:0});g(this,"touchActive",!1);g(this,"disableClick",!1);g(this,"mouseOffset",{x:20,y:15});g(this,"name","LibraryScene");g(this,"touchTimers",{start:0,end:0,tap:!1});return this.resetUserActivity(),this.handlers={click:this.handleClick.bind(this),move:this.onMouseMove.bind(this),start:this.handleTouchStart.bind(this),end:this.onTouchEnd.bind(this),tmove:this.onTouchMove.bind(this)},this.sceneIndex=1,this}resetUserActivity(){this.isUserActive=!0,this.userActivityTimeout&&clearTimeout(this.userActivityTimeout),this.resetTimeout&&clearTimeout(this.resetTimeout),this.userActivityTimeout=setTimeout(()=>{this.isUserActive=!1,this.resetTimeout=setTimeout(()=>{this.isUserActive=!0},1e3)},3e4)}build(){const e=new j;e.name="mainGroup",e.position.z=0;const t=new j;t.name="foregroundGroup",t.userData.position=t.position.clone();const o=new j;o.name="leftSideGroup",o.userData.position=o.position.clone();const i=new j;i.name="rightSideGroup",i.userData.position=i.position.clone();const a=new j;a.name="backgroundGroup",a.userData.position=a.position.clone();const d=new j;d.name="groupObject",d.position.z=0,this.scene.add(e),this.scene.add(d),this.scene.add(a),this.scene.add(o),this.scene.add(i),this.scene.add(t);const h=["background","sideLeft","sideRight","foreground"],y=[{x:0,y:0,z:-5,scx:0,scy:.22},{x:-1,y:0,z:-2,scx:1.1,scy:.12},{x:1,y:0,z:-2,scx:-1.2,scy:.12},{x:0,y:-1,z:-1,scx:0,scy:1.22}];h.forEach((n,w)=>{const r=S(te,m=>m.id===n);if(r){const m=M.getTexture(r.id),x=se.clone();x.map=m,x.opacity=1,x.toneMapped=!1;const u=new B(C,x);u.userData.position_ref=y[w],u.name=r.id,u.userData.scale=r.scale,u.userData.isBase=!0,e.add(u),n==="foreground"&&t.add(u),n==="sideLeft"&&o.add(u),n==="sideRight"&&i.add(u),n==="background"&&a.add(u),u.userData.size={format:r.width>r.height?"paysage":"portrait",ratio:r.width>r.height?r.height/r.width:r.width/r.height}}});const b=["record","typewriter","partitions","carnet","poster","livre","violon","box"],f=[{x:-1.34,y:.05,z:-.9999},{x:2.6,y:.237,z:-.9999},{x:.11,y:.068,z:-.9999},{x:-.29,y:-.02,z:-1.9999},{x:1.6,y:1.02,z:-1.9999},{x:.016,y:1.04,z:-1.9999},{x:3.85,y:1.35,z:-4.9999},{x:-2.02,y:-.82,z:-.9999}],D=["253, 246, 250","253, 246, 250","253, 246, 250","253, 246, 250","253, 246, 250","253, 246, 250","253, 246, 250","253, 246, 250"];b.forEach((n,w)=>{const r=S(V,m=>m.id===n);if(r){const m=M.getTexture(r.id),x=M.getTexture(`${r.id}_glow`),u=new E({uniforms:{uTexture1:{value:m},uTexture2:{value:x},uHover:{value:0},uOpacity:{value:0}},vertexShader:`
            varying vec2 vUv;
            void main() {
              vUv = uv;
              gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
          `,fragmentShader:`
            uniform sampler2D uTexture1;
            uniform sampler2D uTexture2;
            uniform float uHover; // Uniform for hover effect
            varying vec2 vUv;

            void main() {
              vec4 tex1 = texture2D(uTexture1, vUv);
              vec4 tex2 = texture2D(uTexture2, vUv);
              vec4 glow = vec4(tex2.rgb, tex2.a * uHover); // Apply hover value to the glow texture

              // Apply gamma correction
              vec4 correctedTex1 = pow(tex1, vec4(2.2));
              vec4 correctedGlow = pow(glow, vec4(2.2));

              gl_FragColor = correctedTex1 + correctedGlow; // Overlay the glow texture on top of the base texture
              gl_FragColor = pow(gl_FragColor, vec4(1.0 / 2.2)); // Apply inverse gamma correction
            }
          `,transparent:!0}),s=new B(C,u);s.userData.position_ref=f[w],s.name=r.id,s.userData.bgColor=D[w],s.userData.scale=r.scale,(n==="box"||n==="record"||n==="partitions"||n==="typewriter")&&t.add(s),(n==="poster"||n==="carnet")&&o.add(s),n==="livre"&&i.add(s),n==="violon"&&a.add(s),s.userData.size={format:r.width>r.height?"paysage":"portrait",ratio:r.width>r.height?r.height/r.width:r.width/r.height},k.to(s.material.uniforms.uOpacity,{value:0,duration:1}),this.resize()}})}addEvents(){var e,t,o,i,a;(e=v)==null||e.domElement.addEventListener("click",this.handlers.click),(t=v)==null||t.domElement.addEventListener("mousemove",this.handlers.move),(o=v)==null||o.domElement.addEventListener("touchstart",this.handlers.start),(i=v)==null||i.domElement.addEventListener("touchmove",this.handlers.tmove),(a=v)==null||a.domElement.addEventListener("touchend",this.handlers.end)}removeEvents(){var e,t,o,i,a;(e=v)==null||e.domElement.removeEventListener("click",this.handlers.click),(t=v)==null||t.domElement.removeEventListener("mousemove",this.handlers.move),(o=v)==null||o.domElement.removeEventListener("touchstart",this.handlers.start),(i=v)==null||i.domElement.removeEventListener("touchmove",this.handlers.tmove),(a=v)==null||a.domElement.removeEventListener("touchend",this.handlers.end)}resizeGroup(e){A(e.children,t=>{const o=t.userData.isBase?this.sceneSize.height*t.userData.scale:t.userData.scale;if(t.userData.size.format==="paysage"?t.scale.set(o,o*t.userData.size.ratio,1):t.scale.set(o*t.userData.size.ratio,o,1),t.userData.isBase){let i=this.sceneSize.width*t.userData.position_ref.x+t.scale.x*t.userData.position_ref.scx;t.name==="sideRight"&&(i=Math.max(5,i)),t.name==="sideLeft"&&(i=Math.min(-5,i)),t.position.set(i,this.sceneSize.height*t.userData.position_ref.y+t.scale.y*t.userData.position_ref.scy,t.userData.position_ref.z)}else{const i=t.userData.position_ref;t.position.set(e.children[0].position.x+i.x,e.children[0].position.y+i.y,i.z)}t.userData.position=t.position.clone()})}resize(){if(super.resize(),!this.scene.children.length)this.build(),this.addEvents();else{const e=this.scene.getObjectByName("leftSideGroup"),t=this.scene.getObjectByName("rightSideGroup"),o=this.scene.getObjectByName("foregroundGroup"),i=this.scene.getObjectByName("backgroundGroup");A([e,t,o,i],d=>{this.resizeGroup(d)})}}render(e){super.render(e);const t=this.scene.getObjectByName("leftSideGroup"),o=this.scene.getObjectByName("rightSideGroup"),i=this.scene.getObjectByName("foregroundGroup"),a=this.scene.getObjectByName("backgroundGroup"),d=this.sceneSize.width/this.sceneSize.height;this.mouseOffset.x=d<16/10?140:20;const h=.5,y=this.mouse.x?this.mouse.x/(this.sceneSize.width/this.mouseOffset.x):0,b=.2;let f=this.mouse.y/(this.sceneSize.height/this.mouseOffset.y);f=ee(f,-b*2,b);const D=!this.isUserActive;let n=!1;const w=new P(this.mouse.x,this.mouse.y);if(this.raycaster.setFromCamera(w,this.camera),a&&a.children.length>0){const r=-(y*.01),m=-(f*.3);this.touchTimers.tap||G(a.position,[a.userData.position.x+r,a.userData.position.y+m,0],h,e.delta),["violon"].forEach(u=>{const s=a.getObjectByName(u);if(s){const O=s.material,p=this.raycaster.intersectObject(s),T=p.length>0||D?1:0;p.length>0&&!this.touchActive&&(n=!0),"hoverValue"in s.userData||(s.userData.hoverValue=0),n&&(!N.hasTouch||this.touchTimers.tap)&&(s.userData.hoverValue+=(T-s.userData.hoverValue)*.1,O.uniforms.uHover.value=s.userData.hoverValue)}})}if(i&&i.children.length>0){const r=-(y*.1),m=-f;this.touchTimers.tap||G(i.position,[i.userData.position.x+r,i.userData.position.y+m,0],h,e.delta),["box","record","typewriter","partitions"].forEach(u=>{const s=i.getObjectByName(u);if(s){const O=s.material,p=this.raycaster.intersectObject(s),T=p.length>0||D?1:0;p.length>0&&!this.touchActive&&(n=!0),"hoverValue"in s.userData||(s.userData.hoverValue=0),n&&(!N.hasTouch||this.touchTimers.tap)&&(s.userData.hoverValue+=(T-s.userData.hoverValue)*.1,O.uniforms.uHover.value=s.userData.hoverValue)}})}if(t&&t.children.length>0){const r=-(y*.05),m=-f*.7;this.touchTimers.tap||G(t.position,[t.userData.position.x+r,t.userData.position.y+m,0],h,e.delta),["poster","carnet"].forEach(u=>{const s=t.getObjectByName(u);if(s){const O=s.material,p=this.raycaster.intersectObject(s),T=p.length>0||D?1:0;p.length>0&&!this.touchActive&&(n=!0),"hoverValue"in s.userData||(s.userData.hoverValue=0),n&&(!N.hasTouch||this.touchTimers.tap)&&(s.userData.hoverValue+=(T-s.userData.hoverValue)*.1,O.uniforms.uHover.value=s.userData.hoverValue)}})}if(o&&o.children.length>0){const r=-(y*.05),m=-f*.7;this.touchTimers.tap||G(o.position,[o.userData.position.x+r,o.userData.position.y+m,0],h,e.delta),["livre"].forEach(u=>{const s=o.getObjectByName(u);if(s){const O=s.material,p=this.raycaster.intersectObject(s),T=p.length>0||D?1:0;p.length>0&&!this.touchActive&&(n=!0),"hoverValue"in s.userData||(s.userData.hoverValue=0),n&&(!N.hasTouch||this.touchTimers.tap)&&(s.userData.hoverValue+=(T-s.userData.hoverValue)*.1,O.uniforms.uHover.value=s.userData.hoverValue)}})}document.body.style.cursor=n?"pointer":"default"}dispose(){super.dispose(),this.removeEvents(),document.body.style.cursor="default"}getMousePosition(e){const o=e.currentTarget.getBoundingClientRect();let i=0,a=0;e instanceof MouseEvent?(i=e.clientX-o.left,a=e.clientY-o.top):e instanceof TouchEvent&&e.touches.length>0&&(i=e.touches[0].clientX-o.left,a=e.touches[0].clientY-o.top),this.mouse.x=i/v.domElement.offsetWidth*2-1,this.mouse.y=-(a/v.domElement.offsetHeight)*2+1}onMouseMove(e){this.getMousePosition(e),this.resetUserActivity()}handleTouchStart(e){this.touchActive=!0,e.touches.length>0&&(e.preventDefault(),this.getMousePosition(e),this.resetUserActivity(),this.touchTimers.start=Date.now())}onTouchEnd(){this.touchActive=!1,this.touchTimers.end=Date.now(),this.touchTimers.end-this.touchTimers.start<250&&(this.touchTimers.tap=!0,this.handleIntersections())}onTouchMove(e){this.touchActive&&(this.getMousePosition(e),this.resetUserActivity())}handleClick(e){this.getMousePosition(e),this.handleIntersections(),this.resetUserActivity()}handleIntersections(){const e=this.scene.getObjectByName("leftSideGroup"),t=this.scene.getObjectByName("rightSideGroup"),o=this.scene.getObjectByName("foregroundGroup"),i=this.scene.getObjectByName("backgroundGroup"),a=["record","typewriter","partitions","carnet","poster","livre","violon","box"];if(this.disableClick)return;let d;if(e&&t&&o&&i){const h=[...a.map(y=>{const b=S(V,D=>D.id===y);let f=null;return b&&(f=e.getObjectByName(b.id)||t.getObjectByName(b.id)||i.getObjectByName(b.id)||o.getObjectByName(b.id)),f&&f instanceof B&&f.material instanceof E?f:null})].filter(y=>y!==null);h.length>0&&(d=this.raycaster.intersectObjects(h))}if(d&&d.length>0){const h=d[0].object;this.fadeOutAndRedirect(h)}else this.touchTimers.tap=!1}fadeOutAndRedirect(e){const t=this.scene.getObjectByName("leftSideGroup"),o=this.scene.getObjectByName("rightSideGroup"),i=this.scene.getObjectByName("foregroundGroup"),a=this.scene.getObjectByName("backgroundGroup");if(I.disableApp(!0),this.disableClick=!0,t&&o&&i&&a){const d=[...t.children,...o.children,...i.children,...a.children].filter(h=>h instanceof B&&h.material instanceof E);k.timeline().to(d.map(h=>h instanceof B&&h.material instanceof E?h.material.uniforms.uOpacity:null).filter(h=>h!==null),{value:0,duration:1,stagger:.1,ease:"power2.out"}).to(e instanceof B&&e.material instanceof E?e.material.uniforms.uOpacity:null,{value:0,duration:1,ease:"power2.out"}).add(()=>{$.emit(W.CLICK_THEME,{name:e.name,bgColor:e.userData.bgColor})},1)}}exitFromMainHeader(e){let t;const o=this.scene.getObjectByName("leftSideGroup"),i=this.scene.getObjectByName("rightSideGroup"),a=this.scene.getObjectByName("foregroundGroup"),d=this.scene.getObjectByName("backgroundGroup");switch(e){case"/yannick-nezet-seguin/":t=a==null?void 0:a.getObjectByName("partitions");break;case"/charles-dutoit/":t=i==null?void 0:i.getObjectByName("livre");break;case"/universite-de-montreal/":t=o==null?void 0:o.getObjectByName("carnet");break;case"/metier-role-de-critique/":t=a==null?void 0:a.getObjectByName("typewriter");break;case"/les-raretes/":t=a==null?void 0:a.getObjectByName("box");break;case"/festival-de-lanaudiere/":t=d==null?void 0:d.getObjectByName("violon");break;case"/oeuvres-preferees/":t=a==null?void 0:a.getObjectByName("record");break;case"/maria-callas/":t=o==null?void 0:o.getObjectByName("poster");break}t&&this.fadeOutAndRedirect(t)}}export{ce as default};
//# sourceMappingURL=LibraryScene-CwQ7uYtg.js.map
